<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تراث الصدر - الذكاء الاصطناعي</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        paper: { 50: '#f9f7f1', 100: '#f0eadd', 200: '#e3d5c0' },
                        heritage: { gold: '#b47b3e', dark: '#4a3b32', accent: '#8c5e2a' }
                    },
                    fontFamily: {
                        'body': ['Amiri', 'serif'],
                        'heading': ['Cairo', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #f9f7f1; color: #4a3b32; }
        .islamic-pattern {
            background-image: radial-gradient(#b47b3e 0.8px, transparent 0.8px);
            background-size: 24px 24px;
            opacity: 0.05;
        }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen relative">

    <div class="absolute inset-0 islamic-pattern pointer-events-none z-0"></div>
    <div id="root" class="relative z-10"></div>

    <script type="text/babel">
        
        // ==========================================
        // ضع مفتاح API هنا
        // ==========================================
        const API_KEY = "AIzaSyDAbN7hKebJF76qlW_a-lcH5Er1eMlcHew"; 
        
        const SYSTEM_PROMPT = `
        أنت باحث متخصص في التراث الفكري للسيد الشهيد محمد محمد صادق الصدر (قدس سره).
        أجب عن الأسئلة بأسلوب رصين، فقهي أو عقائدي بحسب السياق، واستخدم لغة عربية فصحى عالية الجودة.
        لا تقل أنك ذكاء اصطناعي، بل قدم الإجابة مباشرة.
        `;

        const { useState } = React;

        const App = () => {
            const [query, setQuery] = useState("");
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);

            const handleSearch = async (e) => {
                e.preventDefault();
                if(!query) return;
                
                setLoading(true);
                setResult(null);
                setError(null);

                try {
                    if(!API_KEY || API_KEY.includes("ضع_مفتاحك")) {
                        alert("الرجاء التأكد من وضع مفتاح API");
                        setLoading(false);
                        return;
                    }

                    // ============================================================
                    // التحديث: استخدام الموديل الموجود في قائمتك (gemini-2.0-flash)
                    // ============================================================
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: SYSTEM_PROMPT + "\n\nالسؤال: " + query }] }]
                        })
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }

                    if (data.candidates && data.candidates[0].content) {
                        setResult({
                            question: query,
                            answer: data.candidates[0].content.parts[0].text,
                            source: "تحليل تراث السيد الصدر (قدس سره)"
                        });
                    }
                } catch (error) {
                    console.error(error);
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="max-w-3xl mx-auto px-6 py-12 flex flex-col min-h-screen">
                    <header className={`text-center transition-all duration-500 ${result || error ? 'mt-4 mb-8' : 'mt-20 mb-12'}`}>
                        <h1 className="text-4xl md:text-5xl font-heading font-bold text-heritage-dark">تراث الصدر</h1>
                        <p className="mt-4 text-lg text-heritage-dark/70 font-body">بحث في الموسوعة الفقهية والعقائدية</p>
                    </header>

                    <div className="sticky top-4 z-20 mb-10">
                        <div className="shadow-lg rounded-2xl bg-white p-2 border border-paper-200">
                            <form onSubmit={handleSearch} className="flex items-center">
                                <input 
                                    type="text" 
                                    value={query}
                                    onChange={(e) => setQuery(e.target.value)}
                                    className="flex-1 bg-transparent border-none outline-none text-xl font-body px-4 text-heritage-dark h-12"
                                    placeholder="اكتب سؤالك هنا..."
                                />
                                <button type="submit" disabled={loading} className="bg-heritage-gold text-white px-6 py-2 rounded-xl font-heading hover:bg-heritage-accent transition font-bold">
                                    {loading ? 'جاري البحث...' : 'بحث'}
                                </button>
                            </form>
                        </div>
                    </div>

                    {error && (
                        <div className="fade-in bg-red-50 border border-red-200 rounded-xl p-4 text-center mb-8">
                             <p className="text-red-700 font-heading font-bold mb-2">حدث خطأ تقني</p>
                             <p className="text-red-600 font-body text-sm" dir="ltr">{error}</p>
                        </div>
                    )}

                    {result && (
                        <div className="fade-in bg-white rounded-xl border border-paper-200 shadow-xl overflow-hidden p-8">
                            <h3 className="font-heading text-heritage-gold font-bold mb-4 text-lg">السؤال: {result.question}</h3>
                            <div className="prose prose-xl max-w-none text-heritage-dark font-body leading-loose text-justify whitespace-pre-line">
                                {result.answer}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
