<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تراث الصدر - الذكاء الاصطناعي</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        paper: { 50: '#f9f7f1', 100: '#f0eadd', 200: '#e3d5c0' },
                        heritage: { gold: '#b47b3e', dark: '#4a3b32', accent: '#8c5e2a' }
                    },
                    fontFamily: {
                        'body': ['Amiri', 'serif'],
                        'heading': ['Cairo', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #f9f7f1; color: #4a3b32; }
        .islamic-pattern {
            background-image: radial-gradient(#b47b3e 0.8px, transparent 0.8px);
            background-size: 24px 24px;
            opacity: 0.05;
        }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0"
  }
}
</script>
</head>
<body class="min-h-screen relative">

    <div class="absolute inset-0 islamic-pattern pointer-events-none z-0"></div>
    <div id="root" class="relative z-10"></div>

    <script type="text/babel">
        
        const SYSTEM_PROMPT_AR = `
        أنت باحث متخصص في التراث الفكري للسيد الشهيد محمد محمد صادق الصدر (قدس سره).
        أجب عن الأسئلة بأسلوب رصين، فقهي أو عقائدي بحسب السياق، واستخدم لغة عربية فصحى عالية الجودة.
        لا تقل أنك ذكاء اصطناعي، بل قدم الإجابة مباشرة.
        `;
        const SYSTEM_PROMPT_EN = `
        You are a specialized researcher in the intellectual heritage of Sayyid Muhammad Muhammad Sadiq al-Sadr.
        Answer questions in a sober, jurisprudential, or doctrinal style depending on the context, and use high-quality formal English.
        Do not say you are an AI; provide the answer directly.
        `;

        const { useState, useEffect } = React;

        const App = () => {
            const [query, setQuery] = useState("");
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState(null);
            const [language, setLanguage] = useState("ar");

            useEffect(() => {
                document.documentElement.lang = language;
                document.documentElement.dir = language === 'ar' ? 'rtl' : 'ltr';
                document.title = language === 'ar' ? 'تراث الصدر - الذكاء الاصطناعي' : 'Al-Sadr Legacy - AI';
            }, [language]);

            const handleSearch = async (e) => {
                e.preventDefault();
                if(!query) return;
                
                setLoading(true);
                setResult(null);
                setError(null);

                try {
                    const apiKey = process.env.API_KEY;
                    if(!apiKey) {
                        const errorMsg = language === 'ar' ? "مفتاح API غير متوفر. يرجى التأكد من تكوينه في البيئة." : "API key not available. Please ensure it is configured in the environment.";
                        throw new Error(errorMsg);
                    }
                    
                    const systemPrompt = language === 'ar' ? SYSTEM_PROMPT_AR : SYSTEM_PROMPT_EN;
                    const questionPrefix = language === 'ar' ? "السؤال: " : "Question: ";

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: systemPrompt + "\n\n" + questionPrefix + query }] }]
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `HTTP Error: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }

                    if (data.candidates && data.candidates[0].content) {
                        setResult({
                            question: query,
                            answer: data.candidates[0].content.parts[0].text,
                        });
                    } else {
                        if (data.promptFeedback?.blockReason) {
                            throw new Error(language === 'ar' ? `تم حظر الطلب: ${data.promptFeedback.blockReason}` : `Request was blocked: ${data.promptFeedback.blockReason}`);
                        }
                        throw new Error(language === 'ar' ? 'لم يتم العثور على إجابة.' : 'No answer found.');
                    }
                } catch (error) {
                    console.error(error);
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };
            
            const T = {
                ar: {
                    title: "تراث الصدر",
                    subtitle: "بحث في الموسوعة الفقهية والعقائدية",
                    placeholder: "اكتب سؤالك هنا...",
                    search: "بحث",
                    searching: "جاري البحث...",
                    errorTitle: "حدث خطأ تقني",
                    question: "السؤال",
                },
                en: {
                    title: "The Al-Sadr Legacy",
                    subtitle: "A search in the jurisprudential and doctrinal encyclopedia",
                    placeholder: "Type your question here...",
                    search: "Search",
                    searching: "Searching...",
                    errorTitle: "A technical error occurred",
                    question: "Question",
                }
            };

            return (
                <div className="max-w-3xl mx-auto px-6 py-12 flex flex-col min-h-screen">
                    <header className={`text-center transition-all duration-500 ${result || error ? 'mt-4 mb-8' : 'mt-20 mb-12'}`}>
                        <h1 className="text-4xl md:text-5xl font-heading font-bold text-heritage-dark">{T[language].title}</h1>
                        <p className="mt-4 text-lg text-heritage-dark/70 font-body">{T[language].subtitle}</p>
                    </header>

                    <div className="sticky top-4 z-20 mb-10">
                        <div className="shadow-lg rounded-2xl bg-white p-2 border border-paper-200">
                            <form onSubmit={handleSearch} className="flex items-center gap-2">
                                <select 
                                    value={language} 
                                    onChange={(e) => setLanguage(e.target.value)}
                                    className="bg-paper-100 border border-paper-200 text-heritage-dark font-heading rounded-xl px-4 h-12 focus:outline-none focus:ring-2 focus:ring-heritage-gold"
                                >
                                    <option value="ar">العربية</option>
                                    <option value="en">English</option>
                                </select>
                                <input 
                                    type="text" 
                                    value={query}
                                    onChange={(e) => setQuery(e.target.value)}
                                    className="flex-1 bg-transparent border-none outline-none text-xl font-body px-4 text-heritage-dark h-12"
                                    placeholder={T[language].placeholder}
                                />
                                <button type="submit" disabled={loading} className="bg-heritage-gold text-white px-6 py-2 rounded-xl font-heading hover:bg-heritage-accent transition font-bold h-12">
                                    {loading ? T[language].searching : T[language].search}
                                </button>
                            </form>
                        </div>
                    </div>

                    {error && (
                        <div className="fade-in bg-red-50 border border-red-200 rounded-xl p-4 text-center mb-8">
                             <p className="text-red-700 font-heading font-bold mb-2">{T[language].errorTitle}</p>
                             <p className="text-red-600 font-body text-sm" dir="ltr">{error}</p>
                        </div>
                    )}

                    {result && (
                        <div className="fade-in bg-white rounded-xl border border-paper-200 shadow-xl overflow-hidden p-8">
                            <h3 className="font-heading text-heritage-gold font-bold mb-4 text-lg">{T[language].question}: {result.question}</h3>
                            <div className="prose prose-xl max-w-none text-heritage-dark font-body leading-loose text-justify whitespace-pre-line">
                                {result.answer}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>